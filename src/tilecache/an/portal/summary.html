{% extends "portal/base.html" %}

{% block inlinecss %}
#summarytable { margin-left:auto; margin-right:auto; border-collapse:collapse; border-style:solid; border-width:medium; border-color:black; }
#summarytable td { padding-top:3px; padding-bottom:3px; padding-left:10px; padding-right:10px; border-style:none solid; border-width:thin; border-color:gray; }
#summarytable th { padding-top:3px; padding-bottom:3px; padding-left:10px; padding-right:10px; border-style:solid; border-width:thin; border-color:gray; }
td.c { text-align:center; }
tr.even td { background-color:#EEE; }
tr.odd td {}
.smalllink { font-size:80%; }
{% endblock inlinecss %}

{% block content %}

{% if subs %}
<h3 style="text-align:center;">Multi-File Submissions</h3>
<table id="summarytable">
<tr>
<th>Submission Id</th>
<th>Submitted</th>
<th>Number of Jobs</th>
</tr>
{% for s in subs %}
<tr class="{% cycle even,odd %}">
<td>
<a href="{{ statusurl }}{{ s.jobid }}">{{ s.jobid }}</a>
</td>
<td>
{{ s.format_submittime_brief }}
</td>
<td class="c">
{{ s.jobs.all|length }}
</td>
</tr>
{% endfor %}
</table>

{% endif %}

{% if jobs %}
<h3 style="text-align:center;">Jobs</h3>
<table id="summarytable">
<tr>
<th>Job Id</th>
<th>Submitted</th>
<th>Status</th>
<th>Field</th>
<th>Field<br />Redistributable?</th>
<th>Job open to<br />anyone?</th>
</tr>
{% for job in jobs %}

<tr class="{% cycle even,odd %}">

<td><a href="{{ statusurl }}{{ job.jobid }}"> {{ job.jobid }} </a></td>

<td> {{ job.submission.format_submittime_brief }} </td>

<td class="c">{{ job.status }}
{% if job.failurereason %}
: {{ job.failurereason }}
{% endif %}
</td>

<td>
{% if job.submission.url %}
<a href="{{ job.submission.url }}">{% if job.field.origname %}{{ job.field.origname }}{% else %}URL{% endif %}</a>
&nbsp;
{% endif %}
{% if job.submission.uploaded.userfilename %}
File: {{ job.submission.uploaded.userfilename }}

{% if job.field.origname %}
{% ifequal job.field.origname job.submission.uploaded.userfilename %}
{% else %}
({{ job.field.origname }})
{% endifequal %}
{% endif %}

{% comment %}
{# <a href="{{ getfileurl }}{{ job.jobid }}&f=original"></a> #}
{% ifequal job.jobid job.submission.jobid %}
{% else %}
{# tarfile #}
({{ job.field.origname }})
{% endifequal %}
{% endcomment %}

{% endif %}
<a href="{{ getfield }}{{ job.field.id }}">Stored Copy</a>
</td>

<td class="c">
<form action="{% url an.portal.views.changeperms %}" method="post" name="fieldpermsform_{{ forloop.counter }}">
<input type="hidden" name="fieldid" value="{{ job.field.id }}" />
{% if job.field.redistributable %}
<input type="hidden" name="redist" value="0" />
Yes
&nbsp;
<a href="javascript:document.forms.fieldpermsform_{{ forloop.counter }}.submit();" class="smalllink">Revoke</a>
{% else %}
<input type="hidden" name="redist" value="1" />
No
&nbsp;
<a href="javascript:document.forms.fieldpermsform_{{ forloop.counter }}.submit();" class="smalllink">Grant</a>
{% endif %}
</form>
</td>

<td class="c">
<form action="{% url an.portal.views.changeperms %}" method="post" name="jobpermsform_{{ forloop.counter }}">
<input type="hidden" name="jobid" value="{{ job.jobid }}" />
{% if job.allowanonymous %}
<input type="hidden" name="allowanon" value="0" />
Yes
&nbsp;
<a href="javascript:document.forms.jobpermsform_{{ forloop.counter }}.submit();" class="smalllink">Revoke</a>
{% else %}
<input type="hidden" name="allowanon" value="1" />
No
&nbsp;
<a href="javascript:document.forms.jobpermsform_{{ forloop.counter }}.submit();" class="smalllink">Grant</a>
{% endif %}
</form>
</td>

</tr>
{% endfor %}

</table>
{% else %}
<h3 style="text-align:center;">No Jobs</h3>
{% endif %}{# jobs #}

{% if voimgs %}
<h3 style="text-align:center;">Images Published to the VO</h3>
<table id="summarytable">

<tr>
<th>Field</th>
<th>Center (RA,Dec)</th>
<th>Image Format</th>
<th>Image Size</th>
</tr>

{% for img in voimgs %}
<tr>
<td class="c"><a href="{{ getfield }}{{ img.field.id }}">{{ img.image_title }}</a></td>
<td class="c">({{ img.ra_center|floatformat:2 }}, {{ img.dec_center|floatformat:2 }})</td>
<td class="c"> {{ img.field.filetype }} </td>
<td class="c"> {{ img.field.imagew }} x {{ img.field.imageh }} </td>
</tr>
{% endfor %}

</table>
{% else %}
<h3 style="text-align:center;">No Images Published to the VO</h3>
{% endif %}{# voimgs #}

{% endblock content %}

