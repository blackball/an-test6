{% extends "portal/newjob.html" %}

{% block javascript %}
<script type="text/javascript">
function uploadframeloaded() {
  var form = getUploadForm();
  if (!form) {
    uploadFinished();
	return;
  }
  var doc = getUploadDoc();
  if (doc.getElementById('id_file')) {
    upload_id = form.upload_id.value;
	// set the main form's upload_id hidden field...
	document.forms.longform.upload_id.value = upload_id;
    form.file.addEventListener('focus', setDatasourceFile, true);
    form.addEventListener('submit', onSubmitUpload, true);
  }
}
function getUploadDoc() {
  return document.getElementById('uploadframe').contentDocument;
}
function getUploadForm() {
  var doc = getUploadDoc();
  return doc.getElementById('uploadform');
}
function uploadSucceeded() {
  //alert('upload succeeded: submitting main form.');
  addMissingFormElements();
  document.forms.longform.submit();
}
function uploadFailed() {
  //alert('upload failed.');
  var up = document.getElementById('uploadframe');
  up.src = '{{ uploadform }}';
}
function uploadFinished() {
  var doc = getUploadDoc();
  if (doc.getElementById('upload-succeeded')) {
    //alert('upload succeeded')
	uploadSucceeded();
  } else {
    //alert('upload failed')
	uploadFailed();
  }
}
</script>
{% endblock javascript %}


{% block newjobcontent %}
<form enctype="multipart/form-data" method="post">

{% if urlerr or fileerr %}
<div class="err">
{% if urlerr %}
{{ urlerr }}
{% endif %}
{% if fileerr %}
{{ fileerr }}
{% endif %}
</div>
{% endif %}

<p style="text-align:center">
{% if isurl %}
{{ form.url }}
{% else %}

{% comment %}
{{ form.file }}
{% endcomment %}

<iframe onload="uploadframeloaded()" src="{{ uploadform }}" scrolling="no" frameborder="0" id="uploadframe" style="width:25em; height:2em;">
  [Your user agent does not support iframes]
</iframe>

<div id="progressholder" style="visibility:hidden; height:0px;">
<iframe src="" scrolling="no" frameborder="0" id="progressframe" style="width:25em; height:3em;" >
[no iframes for you!]
</iframe>
</div>


{% endif %}
<input name="submit" value="Submit" type="submit" />
</p>

<div id="switch_views">
{% if isurl %}
<a href="/job/newfile">switch to file upload version</a>
{% else %}
<a href="/job/newurl">switch to image URL version</a>
{% endif %}
&nbsp;&nbsp;
<a href="/job/newlong">switch to full version</a>
</div>

</form>
{% endblock newjobcontent %}

