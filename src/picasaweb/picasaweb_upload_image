#!/bin/bash
#
# usage:
#   ./picasaweb_upload_image filename > foo
#   source foo
# comments:
#   requires environment variables:
#     PICASAWEB_Auth
#     PICASAWEB_USER
#     PICASAWEB_ALBUMID
#   hard-coded FILETYPE
#   caption not yet implemented
#   The "source foo" line sets environment variable:
#     PICASAWEB_PHOTOID
#     PICASAWEB_PHOTOEDITURI
#
FILETYPE=jpeg
uri="http://picasaweb.google.com/data/feed/api/user/$PICASAWEB_USER/albumid/$PICASAWEB_ALBUMID"
xmloutput=$(curl --silent \
  --request POST \
  --data-binary "@$1" \
  --header "Content-Type: image/$FILETYPE" \
  --header "Authorization: GoogleLogin auth=$PICASAWEB_Auth" \
  "$uri")
echo "# $xmloutput"
echo $xmloutput | sed 's/^.*photoid\/\([0-9]*\)\/.*$/export PICASAWEB_PHOTOID=\1/'
echo $xmloutput | sed "s/^.*<link[^>]rel='edit-media'[^>]*href='\([^']*\)'.*/export PICASAWEB_PHOTOEDITURI=\1/"
