{% extends "base.html" %}

{% block inline_css %}
{{block.super}}
<style type="text/css">
#settings_block    {display: none}
.settings_table       {border: 0px; width: 100%;}
.settings_table tr    {vertical-align: top;}
.settings_table td    {vertical-align: top; padding: 20px 5px 20px 5px; border-top: #ccc 1px solid;}
.leftcolumn        {text-align: left; width: 400px}
.setting_title      {font-weight: bold}
.setting_description {font-size: 75%}
#scale_custom_block  {padding-left: 50px}
</style>
{% endblock %}


{% block javascript %}
{{ block.super }}
<script type="text/javascript">
function changeUploadType(type) {
    $('#file_block').toggle(type == 'file');
    $('#url_block').toggle(type == 'url');
}
function changeScaleType(type) {
    $('#ul_block').toggle(type == 'ul');
    $('#ev_block').toggle(type == 'ev');
}
function changeScalePreset(type) {
    $('#scale_custom_block').toggle(type == '5');
}
$(document).ready(function() {
    $('input[name=upload_type]:radio').click(function() {
        changeUploadType($(this).val());
    });
    changeUploadType($('input[name=upload_type]:radio:checked').val());

    $('input[name=scale_type]:radio').click(function() {
        changeScaleType($(this).val());
    });
    changeScaleType($('input[name=scale_type]:radio:checked').val());

    $('input[name=scale_preset]:radio').click(function() {
        changeScalePreset($(this).val());
    });
    changeScalePreset($('input[name=scale_preset]:radio:checked').val());
    
    $('#settings_link').click(function(e) {
        $('#settings_block').slideToggle();
        e.preventDefault();
    }).toggle(function() {
        $(this).children('span').text("[-]");
    }, function() {
        $(this).children('span').text("[+]");
    });
});
</script>
{% endblock %}

{% block title %}
Upload
{% endblock %}

{% block content %}
<form name="upload_form" action="/upload/" method="post" enctype="multipart/form-data">
{% csrf_token %}
{% if form.errors %}
Sorry, your submission could not be completed. Please fix all of the <span class="errorlist">highlighted</span> errors:<br /><br />
{% endif %}
{{ form.upload_type }}
<div id="file_block">{{ form.file }}</div>
<div id="url_block">{{ form.url }}</div>
{{ form.non_field_errors }}
<br />
<table class="settings_table" cellspacing="0">
<tr>
    <td class="leftcolumn">
        <span class="setting_title">File Type:</span><br />
        <span class="setting_description">
            <b>image</b> - A JPEG, GIF, PNG, or FITS image.<br /><br />
            <b>FITS binary table</b> - Must contain a BINTABLE of detected objects, with X and Y pixel positions in "D" (double) or "E" (float) columns, with one object per row.<br /><br />
            <b>text list</b> - A text file, containing two columns of digits separated by commas or whitespace, listing the X,Y positions of sources, sorted with the brightest sources first.<br />
        </span>
    </td>
    <td>
        {{ form.source_type }}
    </td>
</tr>
</table>
    
<h4><a href="#" id="settings_link">Advanced Settings <span>[+]</span></a></h4>
<div id="settings_block">
<table class="settings_table" cellspacing="0">
<tr> 
    <td class="leftcolumn">
        <span class="setting_title">Scale:</span><br />
        <span class="setting_description">If you provide an estimate of the size of your field, our search will be much faster. Most digital-camera images are at least 10 degrees wide; most professional-grade telescopes are narrower than 2 degrees.</span> 
    </td> 
    <td>
        {{ form.scale_preset }}<br />
        <br />
        <div id="scale_custom_block">
            Units: {{ form.scale_units }}<br /><br />
            {{ form.scale_type }}<br /><br />
            <div id="ul_block">
                Lower bound:<br />{{ form.scale_lower.errors }}{{ form.scale_lower }}<br /><br />
                Upper bound:<br />{{ form.scale_upper.errors }}{{ form.scale_upper }}<br />
            </div>
            <div id="ev_block">
                Estimate:<br />{{ form.scale_est.errors }}{{ form.scale_est }}<br /><br />
                Error:<br />{{ form.scale_err.errors }}{{ form.scale_err }}%
            </div>
        </div>
    </td>
</tr> 
<tr> 
    <td class="leftcolumn">
        <span class="setting_title">Parity:</span><br>
        <span class="setting_description">Flipping an image reverses its "parity". If you point a digital camera at the sky and submit the JPEG, it probably has negative parity. If you have a FITS image, it probably has positive parity. Selecting the right parity will make the solving process run faster, but if in doubt just try both.
        </span> 
    </td> 
    <td>
        {{ form.parity.errors }}{{ form.parity }}
    </td>
</tr> 
<tr>  
    <td class="leftcolumn">
        <span class="setting_title">Star Positional Error:</span><br>
        <span class="setting_description">When we find a matching "landmark", we check to see how many of the stars in your field match up with stars we know about. To do this, we need to know how much a star in your field could have moved from where it should be.
        </span> 
    </td> 
    <td>
        {{ form.positional_error.errors }}{{ form.positional_error }} pixels
    </td>
</tr> 
<tr> 
    <td class="leftcolumn">
        <span class="setting_title">Limits:</span><br>
        <span class="setting_description">In order to narrow down our search, you can supply a field center along with a radius. We will only search in indexes which fall within this area.</span> 
    </td> 
    <td>
        RA:<br />{{ form.center_ra.errors }}{{ form.center_ra }} degrees<br /><br />
        Dec:<br />{{ form.center_dec.errors }}{{ form.center_dec }} degrees<br /><br />
        Radius:<br />{{ form.radius.errors }}{{ form.radius }} degrees<br />
    </td>
</tr> 
<tr> 
    <td class="leftcolumn">
        <span class="setting_title">Downsample:</span><br>
        <span class="setting_description">We can downsample your image by a given factor before performing the source extraction.</span> 
    </td> 
    <td>
        {{ form.downsample_factor.errors }}{{ form.downsample_factor }} (factor)<br />
    </td>
</tr> 
</table>
</div>
<input type="submit" value="Submit" />
</form>
{% endblock %}
